[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[dev]
  command = "npm run dev"
  targetPort = 5173
  port = 8888
  framework = "#custom"
  autoLaunch = true

# -------- Default headers (used by `netlify dev`) --------
# Relaxed so Vite React Fast Refresh & source maps work locally.
[[headers]]
  for = "/*"
  [headers.values]
  Content-Security-Policy = """
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval';
    connect-src 'self' http://localhost:* ws://localhost:* https://vmtcofezozrblfxudauk.supabase.co https://vmtcofezozrblfxudauk.functions.supabase.co;
    img-src 'self' data: blob: https:;
    style-src 'self' 'unsafe-inline';
    font-src 'self' data:;
    worker-src 'self' blob:;
    frame-src https://vmtcofezozrblfxudauk.supabase.co;
  """

# -------- Production overrides (strict) --------
[context.production]
  [[headers]]
    for = "/*"
    [headers.values]
    Content-Security-Policy = "default-src 'self'; script-src 'self'; connect-src 'self' https://vmtcofezozrblfxudauk.supabase.co https://vmtcofezozrblfxudauk.functions.supabase.co; img-src 'self' data: blob: https:; style-src 'self' 'unsafe-inline'; font-src 'self' data:; worker-src 'self' blob:; frame-src https://vmtcofezozrblfxudauk.supabase.co;"

# SPA fallback so /book and other client routes work
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
